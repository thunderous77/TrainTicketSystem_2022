# TrainTicketSystem_2022

## 指令说明

注：指令参数顺序可换

#### 用户相关

[”timestamp“] add_user -c "cur_username" -u "username" -p "password" -n "name" -m "mailAddr" -g "privilege"（特别的,创建的第一个用户忽略-c -g参数

[”timestamp“] login -u "username" -p "password"

[”timestamp“] logout -u "username"

[”timestamp“] query_profile -c "cur_username" -u "username"

[”timestamp“] modify_profile -c "cur_username" -u "username" (-p "password") (-m "mailAddr") (-g "privilege")

#### 车票相关

[”timestamp“] add_train -i "trainID" -n "stationNum" -m "seatNum" -s "stations" -p "prices" -x "startTime" -t "travelTimes" -o "stopoverTimes" -d "saleDate" -y "type"(其中-s,-p,-t,-o,-d可能由多个值组成，两个值之间以"|"隔开且不带空格

[”timestamp“] release_train -i "trainID"

[”timestamp“] query_train -i "trainID" -d "mm-dd"

[”timestamp“] query_ticket -s "startStation" -t "destinationStation" -d "mm-dd" (-p time/cost) (不加-p默认以票价排序)

[”timestamp“] query_transfer -s "startStation" -t "destinationStation" -d "mm-dd" (-p time/cost) (恰好换乘一次,只输出最优解)

[”timestamp“] buy_ticket -u "username" -i "trainID" -d "mm-dd" -n "number" -f "startStation" -t "destinationStation" (-q false/true) 

[”timestamp“] query_order -u "username"

[”timestamp“] refund_ticket -u "username" (-n "TDnumber")

[”timestamp“] rollback -t "preTime"

[”timestamp“] clean

[”timestamp“] exit

## 模块划分

#### 主程序模块

```
int main(){
	Order_System OrderSystem;
	string order;
	while(getline(cin,order)){
		try{
			OrderSystem.AnalysisOrder(order);
		}
		catch(Order_Invalid Ex){
			Ex.Output();
		}
		catch(Other_Error Ex){
			Ex.Output();
		}
	}
	return 0;
}
```



#### 命令读取模块

```
void DivideOrder(string order);
void AnalysisOrder(string order);
```



#### 用户模块

```
void add_user();
void login();
void logout();
void query_profile();
void modify_profile();
void clean();
void rollback();
```



#### 火车票模块

```
void add_train();
void release_train();
void query_train();
void query_ticket();
void query_transfer();
void buy_ticket();
void query_order();
void refund_ticket();
void clean();
void rollback();
```





# 准备大改https://github.com/IvyCharon/Train_Ticket_System/blob/master/program.cpp

创建以下多个Key-value database（键值数据库）

**1.某辆列车(no release)信息**

```
Index1

用于 release_train 询问

key: -i trainID

val: 列车(not release)发售时间区间 及信息(各个站的 trainID 到达时间 出发时间 从始发站到该站的累计票价 该站到下一站的剩余票数)
```

**2.某天出发的某辆列车(release or not release)信息**

```
Index2

用于 query_train 和 buy_ticket 询问

key: -i trainID -d 出发日期

val: 列车(release or not release)信息(各个站的 trainID 到达时间 出发时间 从始发站到该站的累计票价 该站到下一站的剩余票数)
```

**3.某天从某处到某处的列车(release)信息(按time排序)**

```
Index3

用于 query_ticket 和 query_transfer 询问

key: -d 出发日期 -s 出发地点 -t 到达地点 

val: 某天从某处出发到某处的列车(release)的信息（trainID 出发地点 到达地点 出发时间 到达时间 价格 剩余票数） （且先按time排序再按trainID排序
```

**4.某天从某处到某处的列车(release)信息(按cost排序)**

```
Index4

用于 query_ticket 和 query_transfer 询问

key: -d 出发日期 -s 出发地点 -t 到达地点 

val: 某天从某处出发到某处的列车(release)的信息（trainID 出发地点 到达地点 出发时间 到达时间 价格 剩余票数） （且先按cost排序再按trainID排序
```

**5.某天从某处出发的列车(release)信息(按time排序)**

```
Index5

用于 query_transfer 询问

key: -d 出发日期 -s 出发地点

val: 某天从某处出发的列车(release)的信息（trainID 出发地点 到达地点 出发时间 到达时间 价格 剩余票数） （且先按time排序再按trainID排序
```

**6.某天从某处出发的列车(release)信息(按cost排序)**

```
Index6

用于 query_transfer 询问

key: -d 出发日期 -s 出发地点

val: 某天从某处出发的列车(release)的信息（trainID 出发地点 到达地点 出发时间 到达时间 价格 剩余票数） （且先按cost排序再按trainID排序
```

**7.某用户订单信息(按交易时间排序)**

```
Index7

用于 query_order 和 refund_ticket 询问

key: -u 用户名

val: 用户订单信息（订单状态 trainID 出发地点 到达地点 出发时间 到达时间 价格 购买票数 交易时间(戳)） （按交易时间排序
```

**8.某辆列车的queue订单信息(按交易时间排序)**

```
Index7

用于 query_order 和 refund_ticket 询问

key: - 列车

val: queue用户订单信息（订单状态 trainID 出发地点 到达地点 出发时间 到达时间 价格 购买票数 交易时间(戳)） （按交易时间排序
```





**各个函数对Key-value database的调用和修改**

```
void add_train(){
    修改:Index1,Index2
}
void release_train(){
	查询:Index1
    修改:Index3,Index4,Index5,Index6
}
void query_train(){
    查询:
    修改:
}
void query_ticket(){
    查询:
    修改:
}
void query_transfer(){
查询:
    修改:}
void buy_ticket(){
    查询:
    修改:
}
void query_order(){
    查询:
    修改:
}
void refund_ticket(){
    查询:
    修改:
}
void clean(){
    
}
void rollback(){
}
```





#### 键值数据库存储模块（B+Tree）

```
要求调用接口为：

```





#### 异常抛出模块

```
class Order_Invalid{public:void Output(){printf("Order_Invalid\n");}};
class Other_Error{public:void Output(){printf("Other_Error\n");}};
...
```

